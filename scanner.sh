#!/bin/bash
##############################################
#
# MS08-067 Vuln Scanner by Serhatgksu
# Just made this for educational usage
# This script tested at Kali and Parrot
# For questions, comments or request :
# Telegram @serhatgksu
# 
##############################################

#### RENK TEMALARI
function print() {
    text="$1"
    color="$2"
    if [ "$color" == "gray" ]; then
        header="\e[38;5;250m"
    elif [ "$color" == "red" ]; then
        header="\e[91m"
    elif [ "$color" == "green" ]; then
        header="\e[92m"
    elif [ "$color" == "yellow" ]; then
        header="\e[93m"
    fi
    tail="\e[0m"
    echo -en $header$text$tail
}

#### ROOT KONTROLÜ
if [ $UID -ne 0 ]; then
    echo -e "\\e[91mProgramı root haklarıyla çalıştırmalısınız!\033[m" 
    sleep 3
 	exit
fi

#### BAR 1
taraniyor ()
{
    bar=" IP'LER TARANIYOR +++++++++++++++++++++++++++++++++"
    barlength=${#bar}
    i=0
    while ((i < 100)); do
        n=$((i*barlength / 100))
        printf "\e[00;32m\r[%-${barlength}s]\e[00m" "${bar:0:n}"
        ((i += RANDOM%5+2)) 
        sleep 0.3
    done 
} 

#### BAR 2
bitti ()
{
    bar=" İŞLEM TAMAMLANIYOR +++++++++++++++++++++++++++++++"
    barlength=${#bar}
    i=0
    while ((i < 100)); do
        n=$((i*barlength / 100))
        printf "\e[00;32m\r[%-${barlength}s]\e[00m" "${bar:0:n}"
        ((i += RANDOM%5+2)) 
        sleep 0.3
    done 
}

#### IP RANGE DÖNGÜSÜ
ip1=( $(echo "$1" | sed 's/\./ /g') )
ip2=( $(echo "$2" | sed 's/\./ /g') )

echo "==================================================="
echo "              Auto MS08-067 Scanner v1.0"
echo "                http://cyberjunior.org"
echo "                     by Serhatgksu"
echo "===================================================" 

for i in $(seq ${ip1[0]} ${ip2[0]})

 do

  for j in $(seq ${ip1[1]} ${ip2[1]})

   do

    for k in $(seq ${ip1[2]} ${ip2[2]})

     do

      for l in $(seq ${ip1[3]} ${ip2[3]})

       do
       	#### MS08-067 NMAP TARAMASI
       	nmap --script smb-vuln-ms08-067.nse -p 445 $i.$j.$k.$l > SCANFILE.txt
       	CHECK=$(cat SCANFILE.txt | grep VULN)
       	### ZAFİYETLİ SUNUCU KONTROLÜ
       	if [[ $CHECK != "" ]]; then
			echo $i.$j.$k.$l >> $1-$2.txt
		fi		
		rm SCANFILE.txt
       done
      
     done

   done

done

echo
bitti
echo



